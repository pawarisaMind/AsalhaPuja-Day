<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      overflow: hidden;
      height: 100vh;
      position: relative;
    }

    h1 {
      text-align: center;
      color: white;
      text-shadow: 0 0 10px gold;
      margin-top: 1rem;
      font-size: 2.5rem;
    }

    #characterLayer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .character-wrapper {
      position: absolute;
      bottom: 10px;
      right: -20%;
      animation: walk-left 25s linear infinite;
    }

    .character-img {
      width: 100px;
    }

    .flower {
      position: absolute;
      bottom: 20px;
      left: 35px;
      width: 50px;
    }

    .user-character {
      animation: none !important;
      right: 50% !important;
      bottom: 120px !important;
      transform: translateX(50%) !important;
      z-index: 5;
    }

    .wish-box {
      position: absolute;
      bottom: 200px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.9);
      padding: 1rem 2rem;
      border-radius: 15px;
      border: 2px solid gold;
      font-size: 1.3rem;
      z-index: 10;
      text-align: center;
      max-width: 80%;
    }

    @keyframes walk-left {
      0% { transform: translateX(0); }
      100% { transform: translateX(-140vw); }
    }
  </style>
</head>
<body>
  <h1>üôè ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô üôè</h1>
  <div id="characterLayer"></div>
  <div id="wishBox" class="wish-box">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏©‡∏ê‡∏≤‡∏ô...</div>

  <script>
    const sheetURL = 'https://script.google.com/macros/s/AKfycbxxxxxxxxxxxxxxxxxxxxxx/exec'; // ‡πÉ‡∏™‡πà URL Web App ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

    const gifMap = {
      boyblue: 'boy1.gif',
      boybrow: 'boy2.gif',
      girlred: 'girl1.gif',
      girlblue: 'girl2.gif',
    };

    const flowerMap = {
      'flower1.png': 'flower1.png',
      'flower2.png': 'flower2.png',
      'flower3.png': 'flower3.png',
      'flower4.png': 'flower4.png',
    };

    const templeBG = {
      '‡∏ß‡∏±‡∏î‡∏ö‡∏±‡∏ß‡∏Ç‡∏ß‡∏±‡∏ç': 'images/‡∏ß‡∏±‡∏î‡∏¢‡∏±‡∏Å‡∏©‡πå‡πÄ‡∏ï‡πá‡∏°.png',
      '‡∏ß‡∏±‡∏î‡∏Å‡∏π‡πâ': 'images/‡∏ß‡∏±‡∏î‡∏Å‡∏π‡πâ‡πÄ‡∏ï‡πá‡∏°.png',
      '‡∏ß‡∏±‡∏î‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏™‡∏π‡∏á': 'images/‡∏ß‡∏±‡∏î‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÄ‡∏ï‡πá‡∏°.png',
    };

    async function loadCharacters() {
      try {
        const res = await fetch(sheetURL);
        const users = await res.json();

        const container = document.getElementById('characterLayer');
        const wishBox = document.getElementById('wishBox');

        const currentUser = users.find(u => u.done === "TRUE" || u.done === true);
        if (currentUser && currentUser.temple && templeBG[currentUser.temple]) {
          document.body.style.backgroundImage = `url('${templeBG[currentUser.temple]}')`;
        }

        users.forEach(user => {
          const wrapper = document.createElement('div');
          wrapper.className = 'character-wrapper';

          if (user.done === "TRUE" || user.done === true) {
            wrapper.classList.add('user-character');
            wishBox.innerHTML = `‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏©‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <strong>${user.wish || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏©‡∏ê‡∏≤‡∏ô"}</strong>`;
          }

          const characterImg = document.createElement('img');
          characterImg.src = 'images/' + (gifMap[user.character] || 'boy1.gif');
          characterImg.className = 'character-img';
          wrapper.appendChild(characterImg);

          if (user.offering && flowerMap[user.offering]) {
            const flowerImg = document.createElement('img');
            flowerImg.src = 'images/' + flowerMap[user.offering];
            flowerImg.className = 'flower';
            wrapper.appendChild(flowerImg);
          }

          container.appendChild(wrapper);
        });
      } catch (err) {
        document.getElementById('wishBox').innerText = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        console.error(err);
      }
    }

    loadCharacters();
  </script>
</body>
</html>
