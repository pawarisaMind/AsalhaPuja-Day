<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>เวียนเทียนสำเร็จ</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      background: no-repeat center center fixed;
      background-size: cover;
      font-family: sans-serif;
    }

    .main-character {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      z-index: 10;
      width: 200px;
    }

    .main-character .character-img {
      width: 200px;
      display: block;
      margin: 0 auto;
    }

    .main-character .wish-box {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-bottom: 10px;
      background: rgba(255,255,255,0.9);
      color: #333;
      font-size: 1.5rem;
      padding: 1rem 2rem;
      border-radius: 20px;
      border: 2px solid gold;
      white-space: nowrap;
    }

    .main-character .flower {
      position: absolute;
      bottom: 55px;
      left: 65%;
      width: 70px;
      transform: rotate(-25deg);
      transform-origin: bottom center;
    }
  </style>
</head>
<body>

  <!-- ✅ ฉากหลัง -->
  <img id="templeLayer" src="" alt="background" style="position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:-1; object-fit:cover;" />

  <!-- ✅ ตัวละครของผู้ใช้ -->
  <div class="main-character">
    <div class="wish-box" id="mainWish">...</div>
    <img class="character-img" id="mainCharacterImg" src="" alt="ตัวละครของฉัน" />
    <img class="flower" id="mainFlower" src="" alt="ดอกไม้ของฉัน" />
  </div>

  <script>
    // ✅ โหลดข้อมูลจาก localStorage
    const characterData = JSON.parse(localStorage.getItem('characterData'));
    const templeData = JSON.parse(localStorage.getItem('templeData'));
    const offeringData = JSON.parse(localStorage.getItem('offeringData'));

    // ✅ แผนที่ภาพตัวละคร
    const pngMap = {
      boyblue: 'boy1.png',
      boybrow: 'boy2.png',
      girlred: 'girl2.png',
      girlblue: 'girl1.png'
    };

    // ✅ แผนที่ดอกไม้
    const flowerMap = {
      'ดอก1': 'images/f1.png',
      'ดอก2': 'images/f2.png',
      'ดอก3': 'images/f3.png',
      'ดอก4': 'images/f4.png'
    };

    // ✅ แผนที่ฉากวัด
    const measureImages = {
      'วัดบัวขวัญ': {
        desktop: 'images/วัดยักษ์เต็ม.png',
        mobile: 'images/วัดยักษ์โทร.png'
      },
      'วัดกู้': {
        desktop: 'images/วัดกู้เต็ม.png',
        mobile: 'images/วัดกู้เต็มโทร1.png'
      },
      'วัดสะพานสูง': {
        desktop: 'images/วัดสะพานเต็ม.png',
        mobile: 'images/วัดสะพานโทร.png'
      }
    };

    // ✅ กำหนดฉากหลัง
    const isMobile = window.innerWidth <= 480;
    const bgImage = isMobile
      ? measureImages[templeData?.temple]?.mobile
      : measureImages[templeData?.temple]?.desktop;

    if (bgImage) {
      document.getElementById('templeLayer').src = bgImage;
    } else {
      document.getElementById('templeLayer').src = 'images/default-bg.png';
    }

    // ✅ ตั้งค่าภาพตัวละคร
    const characterImg = 'images/' + (pngMap[characterData?.character] || 'default.png');
    document.getElementById('mainCharacterImg').src = characterImg;

    // ✅ ตั้งค่าคำอธิษฐาน
    document.getElementById('mainWish').textContent = offeringData?.wish || 'ขอให้มีความสุข';

    // ✅ ตั้งค่าดอกไม้
    const flowerImg = flowerMap[offeringData?.offering] || 'images/default-f.png';
    document.getElementById('mainFlower').src = flowerImg;
  </script>

</body>
</html>
