<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</title>
  <style>
    @font-face {
      font-family: 'FCMinimal';
      src: url('fonts/FC_Minimal_Regular.ttf') format('truetype');
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: 'FCMinimal', sans-serif;
      overflow-x: hidden;
    }

    body {
      background: no-repeat center center fixed;
      background-size: cover;
      position: relative;
      min-height: 100vh;
    }

    h1 {
      text-align: center;
      color: white;
      text-shadow: 0 0 5px gold;
      font-size: 3rem;
      margin-top: 1rem;
      z-index: 3;
      position: relative;
    }

    .temple-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: 0;
    }

    .main-character {
      position: fixed;
      bottom: 6px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 5;
      text-align: center;
      pointer-events: none;
    }

    .main-character img.character-img {
      width: 200px;
    }

    .main-character .flower {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) rotate(-25deg);
      width: 100px;
      transform-origin: bottom center;
      z-index: 3;
    }

    .main-character .wish-box {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.9);
      color: #333;
      font-size: 1.5rem;
      padding: 1rem 2rem;
      border-radius: 20px;
      border: 2px solid gold;
      white-space: nowrap;
      margin-bottom: 10px;
    }

    .other-character {
      position: absolute;
      bottom: 6px;
      right: -150px;
      animation: walk-left 20s linear forwards;
      z-index: 3;
      pointer-events: none;
      text-align: center;
    }

    .other-character img {
      width: 150px;
    }

    .other-character .wish-box {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      font-size: 1.2rem;
      padding: 0.5rem 1rem;
      border-radius: 15px;
      border: 2px solid gold;
      text-align: center;
      white-space: nowrap;
      z-index: 3;
    }

    .other-character .flower {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) rotate(-25deg);
      height: auto;
      transform-origin: bottom center;
      z-index: 3;
    }

    @keyframes walk-left {
      0% { transform: translateX(0); }
      100% { transform: translateX(-120vw); }
    }

    .share-buttons {
      text-align: center;
      margin-top: 2rem;
      z-index: 10;
      position: relative;
    }

    .share-buttons button {
      padding: 0.7rem 1.5rem;
      font-size: 1.2rem;
      border-radius: 10px;
      border: 2px solid gold;
      cursor: pointer;
      margin: 0.5rem;
      font-family: 'FCMinimal', sans-serif;
    }

    .share-buttons button:hover {
      background-color: gold;
      color: white;
      border-color: #fff;
    }

    @media screen and (max-width: 480px) {
      h1 { font-size: 2rem; }
      .main-character img.character-img { width: 150px; }
      .main-character .flower { width: 70px; }
      .main-character .wish-box { font-size: 1rem; }
      .other-character .wish-box { font-size: 1rem; padding: 0.4rem 0.8rem; }
    }
  </style>
</head>
<body>
  <h1>‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
  <img id="templeLayer" class="temple-layer" src="" alt="background">
  <div id="mainCharacter" class="main-character">
    <div id="mainWish" class="wish-box"></div>
    <img id="mainCharacterImg" class="character-img" src="" alt="‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô">
    <img id="mainFlower" class="flower" src="" alt="‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô">
  </div>
  <div id="otherCharactersArea"></div>
  <div class="share-buttons">
    <button onclick="copyLink()">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
    <button onclick="shareToFacebook()">üîó ‡πÅ‡∏ä‡∏£‡πå Facebook</button>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyChb0EHeLkSneWo7BYwWT_njrU-jZgw_GM",
      authDomain: "asalhapuja-day.firebaseapp.com",
      databaseURL: "https://asalhapuja-day-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "asalhapuja-day",
      storageBucket: "asalhapuja-day.appspot.com",
      messagingSenderId: "776082602779",
      appId: "1:776082602779:web:76551ef38442ed8d9b1be"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const characterData = JSON.parse(localStorage.getItem('characterData'));
    const templeData = JSON.parse(localStorage.getItem('templeData'));
    const offeringData = JSON.parse(localStorage.getItem('offeringData'));

    const gifMap = {
      boyblue: 'boy1.gif',
      boybrow: 'boy2.gif',
      girlred: 'girl2.gif',
      girlblue: 'girl1.gif'
    };

    const pngMap = {
      boyblue: 'boy1.png',
      boybrow: 'boy2.png',
      girlred: 'girl2.png',
      girlblue: 'girl1.png'
    };

    const flowerMap = {
      '‡∏î‡∏≠‡∏Å1': 'images/f1.png',
      '‡∏î‡∏≠‡∏Å2': 'images/f2.png',
      '‡∏î‡∏≠‡∏Å3': 'images/f3.png',
      '‡∏î‡∏≠‡∏Å4': 'images/f4.png'
    };

    const measureImages = {
      '‡∏ß‡∏±‡∏î‡∏ö‡∏±‡∏ß‡∏Ç‡∏ß‡∏±‡∏ç': {
        desktop: 'images/‡∏ß‡∏±‡∏î‡∏¢‡∏±‡∏Å‡∏©‡πå‡πÄ‡∏ï‡πá‡∏°.png',
        mobile: 'images/‡∏ß‡∏±‡∏î‡∏¢‡∏±‡∏Å‡∏©‡πå‡πÇ‡∏ó‡∏£.png'
      },
      '‡∏ß‡∏±‡∏î‡∏Å‡∏π‡πâ': {
        desktop: 'images/‡∏ß‡∏±‡∏î‡∏Å‡∏π‡πâ‡πÄ‡∏ï‡πá‡∏°.png',
        mobile: 'images/‡∏ß‡∏±‡∏î‡∏Å‡∏π‡πâ‡πÄ‡∏ï‡πá‡∏°‡πÇ‡∏ó‡∏£1.png'
      },
      '‡∏ß‡∏±‡∏î‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏™‡∏π‡∏á': {
        desktop: 'images/‡∏ß‡∏±‡∏î‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÄ‡∏ï‡πá‡∏°.png',
        mobile: 'images/‡∏ß‡∏±‡∏î‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÇ‡∏ó‡∏£.png'
      }
    };

    const isMobile = window.innerWidth <= 480;
    const bgImage = isMobile ? measureImages[templeData?.temple]?.mobile : measureImages[templeData?.temple]?.desktop;
    if (bgImage) {
      document.getElementById('templeLayer').src = bgImage;
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á
    document.getElementById('mainCharacterImg').src = 'images/' + (pngMap[characterData.character] || characterData.character + '.png');
    document.getElementById('mainWish').textContent = offeringData?.wish || '';
    document.getElementById('mainFlower').src = flowerMap[offeringData?.offering] || 'images/default-f.png';

    // ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏≠‡∏∑‡πà‡∏ô (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á)
    const otherArea = document.getElementById('otherCharactersArea');
    get(child(ref(db), 'users')).then(snapshot => {
      if (snapshot.exists()) {
        const data = Object.values(snapshot.val());
        let delay = 0;
        data.forEach(user => {
          if (user.name === characterData.name) return; // ‡∏Ç‡πâ‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤

          const wrapper = document.createElement('div');
          wrapper.className = 'other-character';
          wrapper.style.animationDelay = `${delay}s`;

          const img = document.createElement('img');
          img.src = 'images/' + (gifMap[user.character] || user.character + '.gif');
          wrapper.appendChild(img);

          if (user.wish) {
            const wishBox = document.createElement('div');
            wishBox.className = 'wish-box';
            wishBox.textContent = user.wish;
            wrapper.appendChild(wishBox);
          }

          if (user.offering) {
            const flowerImg = document.createElement('img');
            flowerImg.src = flowerMap[user.offering] || 'images/default-f.png';
            flowerImg.className = 'flower';
            wrapper.appendChild(flowerImg);
          }

          otherArea.appendChild(wrapper);
          delay += 2;
        });
      }
    });
  </script>
</body>
</html>
