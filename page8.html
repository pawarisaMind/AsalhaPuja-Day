<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô - ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</title>
  <style>
    @font-face {
      font-family: 'FCMinimal';
      src: url('fonts/FC_Minimal_Regular.ttf') format('truetype');
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'FCMinimal', sans-serif;
      background: url('images/‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á5.gif') no-repeat center center fixed;
      background-size: cover;
      overflow: hidden;
      height: 100vh;
      position: relative;
    }

    h1 {
      text-align: center;
      color: white;
      text-shadow: 0 0 5px gold;
      font-size: 3rem;
      margin-top: 1rem;
      position: relative;
      z-index: 3;
    }

    .character-wrapper {
      position: absolute;
      bottom: 6px;
      z-index: 2;
      animation: walk 15s linear infinite;
    }

    .character-img {
      height: auto;
      max-height: 280px;
    }

    .flower {
      width: 100px;
      margin-top: -30px;
      z-index: 3;
    }

    .wish-box {
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      font-size: 1.5rem;
      padding: 0.6rem 1.2rem;
      border-radius: 20px;
      border: 2px solid gold;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      text-align: center;
      white-space: nowrap;
      font-family: 'FCMinimal', sans-serif;
      margin-bottom: 0.4rem;
    }

    @keyframes walk {
      0% { right: -300px; }
      100% { right: 120vw; }
    }
  </style>
</head>
<body>
  <h1>‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏¢‡∏∏‡∏Ñ‡πÉ‡∏´‡∏°‡πà<br>‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ</h1>
  <div id="characterDisplay"></div>

  <script>
    const characterDisplay = document.getElementById('characterDisplay');

    const gifMap = {
      boyblue: 'boy1.gif',
      boybrow: 'boy2.gif',
      girlred: 'girl1.gif',
      girlblue: 'girl2.gif',
    };

    const flowerMap = {
      '‡∏î‡∏≠‡∏Å1': 'flower1.png',
      '‡∏î‡∏≠‡∏Å2': 'flower2.png',
      '‡∏î‡∏≠‡∏Å3': 'flower3.png',
      '‡∏î‡∏≠‡∏Å4': 'flower4.png',
    };

    const sheetAPI = "https://script.google.com/macros/s/AKfycbznG67SZ0HGAiJXrXBoPZcIIlC46-kuYo6pix8kLr4gXUxxAvx_ON1YEiB1GhluFp34qA/exec";

    // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å localStorage
    const myCharacter = {
      name: localStorage.getItem('myName') || '‡∏â‡∏±‡∏ô‡πÄ‡∏≠‡∏á',
      wish: localStorage.getItem('myWish') || '‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ',
      character: localStorage.getItem('myCharacter') || 'boyblue',
      offering: localStorage.getItem('myFlower') || '‡∏î‡∏≠‡∏Å1'
    };

    function showMyCharacter(character) {
      const wrapper = document.createElement('div');
      wrapper.style.position = 'absolute';
      wrapper.style.bottom = '20px';
      wrapper.style.left = '50%';
      wrapper.style.transform = 'translateX(-50%)';
      wrapper.style.zIndex = '10'; // ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î

      const charImg = document.createElement('img');
      charImg.src = `images/${gifMap[character.character] || 'boy1.gif'}`;
      charImg.className = 'character-img';

      const wishBox = document.createElement('div');
      wishBox.className = 'wish-box';
      wishBox.innerHTML = `üåü ${character.name}: ${character.wish}`;

      const flowerImg = document.createElement('img');
      flowerImg.src = `images/${flowerMap[character.offering] || 'flower1.png'}`;
      flowerImg.className = 'flower';

      const inner = document.createElement('div');
      inner.style.display = 'flex';
      inner.style.flexDirection = 'column';
      inner.style.alignItems = 'center';

      inner.appendChild(wishBox);
      inner.appendChild(charImg);
      inner.appendChild(flowerImg);

      wrapper.appendChild(inner);
      document.body.appendChild(wrapper);
    }

    async function loadCharacters() {
      try {
        const res = await fetch(sheetAPI);
        const data = await res.json();

        data.forEach((item, index) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'character-wrapper';
          wrapper.style.animationDelay = `${index * 2}s`;
          wrapper.style.right = `-${100 + (index * 80)}px`;

          // ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ gif
          const characterFile = gifMap[item.character] || 'boy1.gif';
          const charImg = document.createElement('img');
          charImg.src = `images/${characterFile}`;
          charImg.className = 'character-img';

          // ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏©‡∏ê‡∏≤‡∏ô
          const wishBox = document.createElement('div');
          wishBox.className = 'wish-box';
          wishBox.innerHTML = `üôè ${item.name}: ${item.wish}`;

          // ‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ
          const flowerFile = flowerMap[item.offering] || 'flower1.png';
          const flowerImg = document.createElement('img');
          flowerImg.src = `images/${flowerFile}`;
          flowerImg.className = 'flower';

          // ‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á
          const inner = document.createElement('div');
          inner.style.display = 'flex';
          inner.style.flexDirection = 'column';
          inner.style.alignItems = 'center';

          inner.appendChild(wishBox);
          inner.appendChild(charImg);
          inner.appendChild(flowerImg);

          wrapper.appendChild(inner);
          characterDisplay.appendChild(wrapper);
        });

        // üëâ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à
        showMyCharacter(myCharacter);

      } catch (err) {
        console.error("‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
        showMyCharacter(myCharacter); // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏°‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
      }
    }

    window.addEventListener("DOMContentLoaded", loadCharacters);
  </script>
</body>
</html>
