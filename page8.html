<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</title>
  <style>
    @font-face {
      font-family: 'FCMinimal';
      src: url('fonts/FC_Minimal_Regular.ttf') format('truetype');
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: 'FCMinimal', sans-serif;
      overflow-x: hidden;
    }

    body {
      background: no-repeat center center fixed;
      background-size: cover;
      position: relative;
      min-height: 100vh;
    }

    h1 {
      text-align: center;
      color: white;
      text-shadow: 0 0 5px gold;
      font-size: 3rem;
      margin-top: 1rem;
      z-index: 3;
      position: relative;
    }

    .temple-layer {
      position: absolute;
      bottom: -5.7%;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .main-character {
      position: absolute;
      bottom: 6px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 5;
      text-align: center;
    }

    .main-character img.character-img {
      width: 200px;
    }

    .main-character .flower {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
    }

    .main-character .wish-box {
      background: rgba(255,255,255,0.9);
      color: #333;
      font-size: 1.5rem;
      padding: 1rem 2rem;
      border-radius: 20px;
      border: 2px solid gold;
      white-space: nowrap;
      margin-bottom: 10px;
    }

   .other-character {
  position: absolute;
  bottom: 6px;
  right: -150px; /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Ç‡∏≠‡∏ö‡∏Ç‡∏ß‡∏≤‡∏ô‡∏≠‡∏Å‡∏à‡∏≠ */
  animation: walk-left 20s linear forwards;
  z-index: 3;
  pointer-events: none;
}

    .other-character img {
      width: 150px;
    }

    @keyframes walk-left {
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(-120vw); /* ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏û‡πâ‡∏ô‡∏à‡∏≠ */
  }
}

    .wish-box {
      position: absolute;
      bottom: 80%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      font-size: 1.2rem;
      padding: 0.5rem 1rem;
      border-radius: 15px;
      border: 2px solid gold;
      text-align: center;
      white-space: nowrap;
      z-index: 3;
    }

    .flower {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      z-index: 3;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå */
    .share-buttons {
      text-align: center;
      margin-top: 2rem;
      z-index: 10;
      position: relative;
    }

    .share-buttons button {
      padding: 0.7rem 1.5rem;
      font-size: 1.2rem;
      border-radius: 10px;
      border: 2px solid gold;
      cursor: pointer;
      margin: 0.5rem;
      font-family: 'FCMinimal', sans-serif;
    }

    .share-buttons button:hover {
      background-color: gold;
      color: white;
      border-color: #fff;
    }

    @media screen and (max-width: 480px) {
      h1 {
        font-size: 2rem;
      }
      .main-character img.character-img {
        width: 150px;
      }
      .main-character .flower {
        width: 70px;
      }
      .main-character .wish-box {
        font-size: 1rem;
      }
      .wish-box {
        font-size: 1rem;
        padding: 0.4rem 0.8rem;
      }
      .flower {
        width: 60px;
      }
    }
  </style>
</head>
<body>
  <h1>‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>

  <div id="templeArea"></div>
  <div id="mainCharacterArea"></div>
  <div id="otherCharactersArea"></div>

  <div class="share-buttons">
    <button onclick="copyLink()">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
    <button onclick="shareToFacebook()">üîó ‡πÅ‡∏ä‡∏£‡πå Facebook</button>
  </div>

  <!-- ‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏¥‡∏á‡∏Å‡πå -->
  <script>
    function copyLink() {
      navigator.clipboard.writeText(window.location.href)
        .then(() => alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!"))
        .catch(() => alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏î‡πâ"));
    }

    function shareToFacebook() {
      const shareUrl = encodeURIComponent(window.location.href);
      const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`;
      window.open(facebookUrl, '_blank');
    }
  </script>

  <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ -->
  <script type="module">
    
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyChb0EHeLkSneWo7BYwWT_njrU-jZgw_GM",
      authDomain: "asalhapuja-day.firebaseapp.com",
      databaseURL: "https://asalhapuja-day-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "asalhapuja-day",
      storageBucket: "asalhapuja-day.appspot.com",
      messagingSenderId: "776082602779",
      appId: "1:776082602779:web:76551ef38442ed8d9b1be"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const characterData = JSON.parse(localStorage.getItem('characterData'));
    const templeData = JSON.parse(localStorage.getItem('templeData'));
    const offeringData = JSON.parse(localStorage.getItem('offeringData'));

    const gifMap = {
      boyblue: 'boy1.gif',
      boybrow: 'boy2.gif',
      girlred: 'girl1.gif',
      girlblue: 'girl2.gif'
    };

    const flowerMap = {
      'flower1.png': 'images/flower1.png',
      'flower2.png': 'images/flower2.png',
      'flower3.png': 'images/flower3.png',
      'flower4.png': 'images/flower4.png'
    };

    // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏î
    const measureImages = {
      '‡∏ß‡∏±‡∏î‡∏ö‡∏±‡∏ß‡∏Ç‡∏ß‡∏±‡∏ç': {
        desktop: 'images/‡∏ß‡∏±‡∏î‡∏¢‡∏±‡∏Å‡∏©‡πå‡πÄ‡∏ï‡πá‡∏°.png',
        mobile: 'images/‡∏ß‡∏±‡∏î‡∏¢‡∏±‡∏Å‡∏©‡πå‡πÇ‡∏ó‡∏£.png'
      },
      '‡∏ß‡∏±‡∏î‡∏Å‡∏π‡πâ': {
        desktop: 'images/‡∏ß‡∏±‡∏î‡∏Å‡∏π‡πâ‡πÄ‡∏ï‡πá‡∏°.png',
        mobile: 'images/‡∏ß‡∏±‡∏î‡∏Å‡∏π‡πâ‡πÄ‡∏ï‡πá‡∏°‡πÇ‡∏ó‡∏£1.png'
      },
      '‡∏ß‡∏±‡∏î‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡∏™‡∏π‡∏á': {
        desktop: 'images/‡∏ß‡∏±‡∏î‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÄ‡∏ï‡πá‡∏°.png',
        mobile: 'images/‡∏ß‡∏±‡∏î‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÇ‡∏ó‡∏£.png'
      }
    };

    const measure = templeData?.temple;
    const isMobile = window.innerWidth <= 480;
    const bgImage = isMobile ? measureImages[measure]?.mobile : measureImages[measure]?.desktop;
    if (bgImage) {
      document.body.style.backgroundImage = `url('${bgImage}')`;
      const templeImg = document.createElement('img');
      templeImg.src = bgImage;
      templeImg.className = 'temple-layer';
      document.getElementById('templeArea').appendChild(templeImg);
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏´‡∏•‡∏±‡∏Å
    const mainWrapper = document.createElement('div');
    mainWrapper.className = 'main-character';

    const mainImg = document.createElement('img');
    mainImg.src = 'images/' + (gifMap[characterData.character] || characterData.character + '.png');
    mainImg.className = 'character-img';
    mainWrapper.appendChild(mainImg);

    if (offeringData?.wish) {
      const wishBox = document.createElement('div');
      wishBox.className = 'wish-box';
      wishBox.textContent = offeringData.wish;
      mainWrapper.appendChild(wishBox);
    }

    if (offeringData?.offering) {
      const flowerImg = document.createElement('img');
      flowerImg.src = flowerMap[offeringData.offering] || 'images/default-flower.png';
      flowerImg.className = 'flower';
      mainWrapper.appendChild(flowerImg);
    }

    document.getElementById('mainCharacterArea').appendChild(mainWrapper);

    // ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Firebase
    const currentCharacter = characterData?.character;
    const otherArea = document.getElementById('otherCharactersArea');

    get(child(ref(db), 'users')).then(snapshot => {
      if (snapshot.exists()) {
        const data = Object.values(snapshot.val());
        data.forEach((user, index) => {
  setTimeout(() => {
    const wrapper = document.createElement('div');
    wrapper.className = 'other-character';
    wrapper.style.animationDelay = '0s'; // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏á‡∏ã‡πâ‡∏≥‡πÉ‡∏ô CSS ‡πÅ‡∏•‡πâ‡∏ß

    const img = document.createElement('img');
    img.src = 'images/' + (gifMap[user.character] || user.character + '.png');
    img.loading = 'lazy'; // ‡πÄ‡∏û‡∏¥‡πà‡∏° lazy load
    wrapper.appendChild(img);

    if (user.wish) {
      const wishBox = document.createElement('div');
      wishBox.className = 'wish-box';
      wishBox.textContent = user.wish;
      wrapper.appendChild(wishBox);
    }

    if (user.offering) {
      const flowerImg = document.createElement('img');
      flowerImg.src = flowerMap[user.offering] || 'images/default-flower.png';
      flowerImg.className = 'flower';
      flowerImg.loading = 'lazy';
      wrapper.appendChild(flowerImg);
    }

    otherArea.appendChild(wrapper);

  }, index * 1000); // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡∏ó‡∏µ‡∏•‡∏∞ 1 ‡∏ß‡∏¥
});
        data.forEach(user => {
          if (user.character !== currentCharacter) {
            const wrapper = document.createElement('div');
            wrapper.className = 'other-character';
            wrapper.style.animationDelay = `${delay}s`;

            const img = document.createElement('img');
            img.src = 'images/' + (gifMap[user.character] || user.character + '.png');
            wrapper.appendChild(img);

            if (user.wish) {
              const wishBox = document.createElement('div');
              wishBox.className = 'wish-box';
              wishBox.textContent = user.wish;
              wrapper.appendChild(wishBox);
            }

            if (user.offering) {
              const flowerImg = document.createElement('img');
              flowerImg.src = flowerMap[user.offering] || 'images/default-flower.png';
              flowerImg.className = 'flower';
              wrapper.appendChild(flowerImg);
            }

            otherArea.appendChild(wrapper);
            delay += 4;
          }
        });
      }
    });
  </script>
</body>
</html> 
